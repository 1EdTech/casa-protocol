{
  "id": "casa-protocol-schema-payload",
  "$schema": "https://github.com/AppSharing/casa-protocol/blob/master/schema/payload.json",
  "description": "The CASA Protocol defines payload structures within the Community App Sharing Architecture",
  "type": "object",
  "definitions": {
    
    "Payload": {
      "type": "object",
      "properties": {
        "identity": { "$ref": "#/definitions/PayloadIdentity" },
        "original": { "$ref": "#/definitions/PayloadLocalAttributes" },
        "journal": { "type": "array", "items": { "$ref": "#/definitions/PayloadLocalJournalEntry" } },
        "attributes": { "$ref": "#/definitions/PayloadLocalAttributes" }
      },
      "required": [ "identity", "original", "attributes" ]
    },

    "TransitPayload": {
      "type": "object",
      "properties": {
        "identity": { "$ref": "#/definitions/PayloadIdentity" },
        "original": { "$ref": "#/definitions/PayloadTransitAttributes" },
        "journal": { "type": "array", "items": { "$ref": "#/definitions/PayloadTransitJournalEntry" } }
      },
      "required": [ "identity", "original" ]
    },
    
    "LocalPayload": {
      "type": "object",
      "properties": {
        "identity": { "$ref": "#/definitions/PayloadIdentity" },
        "attributes": { "$ref": "#/definitions/PayloadLocalAttributes" }
      },
      "required": [ "identity", "attributes" ]
    },
    
    "PayloadIdentity": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "originator": { "type": "string", "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$" }
      },
      "required": [ "id", "originator" ]
    },
    
    "PayloadAbstractJournalEntry": {
      "type": "object",
      "properties": {
        "originator": { "type": "string", "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    
    "PayloadAbstractAttributes": {
      "type": "object",
      "properties": {
        "uri": { "type": "string", "format": "uri" },
        "share": { "type": "boolean", "default": false },
        "propagate": { "type": "boolean", "default": false }
      },
      "additionalProperties": { "$ref": "#/definitions/PayloadAbstractJournalEntry/properties" },
      "required": ["uri", "originator", "timestamp", "share", "propagate"]
    },
    
    "PayloadLocalJournalEntry": {
      "type": "object",
      "properties": {
        "use": {
          "type": "object",
          "patternProperties": {
            "." : {  "type": [ "array", "boolean", "integer", "null", "number", "object", "string" ] }
          },
          "default": {}
        },
        "require": {
          "type": "object",
          "patternProperties": {
            "." : { "type": [ "array", "boolean", "integer", "null", "number", "object", "string" ] }
          },
          "default": {}
        }
      },
      "additionalProperties": { "$ref": "#/definitions/PayloadAbstractJournalEntry/properties" },
      "required": [ "originator", "timestamp" ]
    },
    
    "PayloadLocalAttributes": {
      "type": "object",
      "properties": {
        "use": {
          "type": "object",
          "patternProperties": {
            "." : {  "type": [ "array", "boolean", "integer", "null", "number", "object", "string" ] }
          },
          "default": {}
        },
        "require": {
          "type": "object",
          "patternProperties": {
            "." : { "type": [ "array", "boolean", "integer", "null", "number", "object", "string" ] }
          },
          "default": {}
        }
      },
      "additionalProperties": { "$ref": "#/definitions/PayloadAbstractAttributes/properties" },
      "required": [ "uri", "originator", "timestamp", "share", "propagate" ]
    },
    
    "PayloadTransitJournalEntry": {
      "type": "object",
      "properties": {
        "use": {
          "type": "object",
          "patternProperties": {
            "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$" : {
              "type": [ "array", "boolean", "integer", "null", "number", "object", "string" ]
            }
          },
          "default": {}
        },
        "require": {
          "type": "object",
          "patternProperties": {
            "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$" : {
              "type": [ "array", "boolean", "integer", "null", "number", "object", "string" ]
            }
          },
          "default": {}
        }
      },
      "additionalProperties": { "$ref": "#/definitions/PayloadAbstractJournalEntry/properties" },
      "required": [ "originator", "timestamp" ]
    },
    
    "PayloadTransitAttributes": {
      "type": "object",
      "properties": {
        "use": {
          "type": "object",
          "patternProperties": {
            "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$" : {
              "type": [ "array", "boolean", "integer", "null", "number", "object", "string" ]
            }
          },
          "default": {}
        },
        "require": {
          "type": "object",
          "patternProperties": {
            "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$" : {
              "type": [ "array", "boolean", "integer", "null", "number", "object", "string" ]
            }
          },
          "default": {}
        }
      },
      "additionalProperties": { "$ref": "#/definitions/PayloadAbstractAttributes/properties" },
      "required": [ "uri", "originator", "timestamp", "share", "propagate" ]
    }
    
  }
}